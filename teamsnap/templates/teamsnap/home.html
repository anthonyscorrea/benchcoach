{% extends "base.html" %}
{% block title %} {{ title }}{% endblock %}

{% block content %}
    <h1>Currently Logged in as</h1>
    <p><b>BenchCoach: </b>{{ user }} ({{ user.email }})</p>
    <p><b>TeamSnap: </b>{{ teamsnap_user.email }}</p>
    <p><b>TeamSnap Managed Team: </b>{{ teamsnap_team.name }}</p>

    <button type="button" class="btn btn-primary m-1" onclick="sync_teamsnap_db()">
        Sync TeamSnap DB
        <div id="teamsnap-sync-spinner" class="spinner-border spinner-border-sm d-none" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </button>
    <button type="button" class="btn btn-primary m-1" onclick="sync_teamsnap_db()">
        Sync TeamSnap DB
        <div id="teamsnap-sync-spinner" class="spinner-border spinner-border-sm d-none" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </button>
    {% include 'messages.html' %}
    <div id="message-area"> </div>
    <script>
        const progress_spinner = document.getElementById("teamsnap-sync-spinner")
        const message_area = document.getElementById("message-area")
        function sync_teamsnap_db(){
            const Http = new XMLHttpRequest();
            const url='{% url 'sync teamsnap db' %}';
            console.log(progress_spinner)
            progress_spinner.classList.remove("d-none");
            fetch(url)
                .then((response) => {
                    progress_spinner.classList.add("d-none")
                    message_area.innerText = "test"
                    return response.json();
                })
                .then((myJson) => {
                    console.log(myJson)
                    message_area.innerHTML = myJson.msg
                });
        }

        function sync_teamsnap_db_2(){
            const Http = new XMLHttpRequest();
            const url='{% url 'sync teamsnap db' %}';
            console.log(progress_spinner)
            progress_spinner.classList.remove("d-none");
            fetch(url)
                .then((response) => {
                    progress_spinner.classList.add("d-none")
                    message_area.innerText = "test"
                    return response.json();
                })
                .then((myJson) => {
                    console.log(myJson)
                    message_area.innerHTML = myJson.msg
                });
        }

        function clear_output_box(){
            progress_spinner.classList.add('d-none')
        }

    </script>

{% endblock %}